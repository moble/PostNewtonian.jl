<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Adding terms · PostNewtonian.jl</title><meta name="title" content="Adding terms · PostNewtonian.jl"/><meta property="og:title" content="Adding terms · PostNewtonian.jl"/><meta property="twitter:title" content="Adding terms · PostNewtonian.jl"/><meta name="description" content="Documentation for PostNewtonian.jl."/><meta property="og:description" content="Documentation for PostNewtonian.jl."/><meta property="twitter:description" content="Documentation for PostNewtonian.jl."/><meta property="og:url" content="https://moble.github.io/PostNewtonian.jl/stable/adding_terms/"/><meta property="twitter:url" content="https://moble.github.io/PostNewtonian.jl/stable/adding_terms/"/><link rel="canonical" href="https://moble.github.io/PostNewtonian.jl/stable/adding_terms/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PostNewtonian.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Interface</span><ul><li><a class="tocitem" href="../interface/high-level/">High-level interface</a></li><li><a class="tocitem" href="../interface/units/">Units</a></li><li><a class="tocitem" href="../interface/differentiation/">Automatic differentiation</a></li><li><a class="tocitem" href="../interface/assorted_binaries/">Assorted binaries</a></li><li><a class="tocitem" href="../interface/python/">Python</a></li><li><a class="tocitem" href="../interface/gwframes/">GWFrames</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../internals/code_structure/">Code structure</a></li><li><a class="tocitem" href="../internals/pn_systems/">PN systems</a></li><li><a class="tocitem" href="../internals/fundamental_variables/">Fundamental variables</a></li><li><a class="tocitem" href="../internals/derived_variables/">Derived variables</a></li><li><a class="tocitem" href="../internals/pn_expressions/">PN expressions</a></li><li><a class="tocitem" href="../internals/dynamics/">Dynamics</a></li><li><a class="tocitem" href="../internals/waveforms/">Waveforms</a></li><li><a class="tocitem" href="../internals/utilities/">Utilities</a></li></ul></li><li class="is-active"><a class="tocitem" href>Adding terms</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Adding terms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Adding terms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/moble/PostNewtonian.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/moble/PostNewtonian.jl/blob/main/docs/src/adding_terms.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Adding-new-PN-terms-or-expressions"><a class="docs-heading-anchor" href="#Adding-new-PN-terms-or-expressions">Adding new PN terms or expressions</a><a id="Adding-new-PN-terms-or-expressions-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-new-PN-terms-or-expressions" title="Permalink"></a></h1><div class="admonition is-danger"><header class="admonition-header">Cite your sources!</header><div class="admonition-body"><p>Remember that it is <em>absolutely crucial</em> to record the source of any expressions in the relevant docstrings, including a link to the relevant paper.  If the terms or expressions in a given function come from more than one source, use comments inside the code itself to clarify exactly which parts come from which source.</p></div></div><p>The first step in actually adding new information is to decide where it fits in the hierarchy described in the <a href="../internals/code_structure/#Structure-of-this-package&#39;s-code">&quot;Code structure&quot; page</a>.  Most likely, you will want to add new terms to existing PN expressions, and possibly simple functions in <a href="../internals/derived_variables/#Derived-variables"><code>PostNewtonian.DerivedVariables</code></a>.</p><p>Existing code should be a good guide on how to do this.  However, it may appear as if some magic is happening in the various PN expressions, whereby variables like <code>M₁</code>, <code>χ⃗₂</code>, <code>ν</code>, <code>Λ</code>, etc., can be used without being defined.  These are automatically computed by way of the <a href="../internals/utilities/#PostNewtonian.@pn_expression-Tuple{Any}"><code>@pn_expression</code></a> macro.  Also note that to correctly truncate a PN expansion at the desired order, the <a href="../internals/utilities/#PostNewtonian.@pn_expansion-Tuple{Any, Any}"><code>@pn_expansion</code></a> macro must be used.</p><p>To make it easier to compare code to original sources, we also want to keep the code looking as similar as possible to equations as given in those sources, so try to keep variable names the same, and order things in the same ways as in the sources.  (Don&#39;t worry about rewriting expressions to optimize evaluation; Julia will probably do a better job automatically anyway.)  There are, however, a few important exceptions to this rule:</p><ol><li>If you need any new variables to be computed from the <a href="../internals/fundamental_variables/#Fundamental-variables">&quot;fundamental variables&quot;</a>, you should define them in the <a href="../internals/derived_variables/#Derived-variables"><code>PostNewtonian.DerivedVariables</code></a> module.  This will ensure that they can be automatically computed using the <a href="../internals/utilities/#PostNewtonian.@pn_expression-Tuple{Any}"><code>@pn_expression</code></a>.</li><li>It is crucial to explicitly include factors of <span>$1/c$</span> to the appropriate power <em>relative to the 0-pN order term</em> inside the <code>@pn_expansion</code> macro.  For example, the first couple terms in the binding energy expansion look like<pre><code class="language-julia hljs">32/5G * ν^2 * v^10 / c^5 * @pn_expansion(1 + (v/c)^2 * (-1247//336 - 35ν/12))</code></pre>The <code>1/c^5</code> factor at the beginning is useful to remind us of the <em>absolute</em> order of this expression, but the <code>1/c^2</code> factor inside the <code>@pn_expansion</code> macro is crucial to ensure that the expression can be correctly truncated at the desired order. Thus, if you want to add a new 6-pN term to the binding energy, you could either manually code it inside the <code>@pn_expansion</code> expression, including its <code>1/c^12</code> factor, or you could create a separate function that should look like this:<pre><code class="language-julia hljs">@pn_expression function binding_energy_6pn(pnsystem::PNSystem)
    32/5G * ν^2 * v^12 / c^5 * @pn_expansion((v/c)^12 * 17//4)
end</code></pre>Note that we have kept the <code>1/c^5</code> factor out front, and the <code>1/c^12</code> factor inside the <code>@pn_expansion</code> macro.  This tells the compiler that this is a 6-pN term, so if the user requests a lower pN order, the term should be ignored.</li><li>It should be possible to evaluate PN expressions using different precisions.  To ensure this, enter fractions as <code>Irrational</code>s — e.g., <code>9//5</code> instead of <code>9/5</code>.  The latter would be immediately converted to the inexact 64-bit float value <code>1.8</code>, which would poison other values.  Note that if you are multiplying by something else that already has general float type, as in <code>9π/5</code>, you don&#39;t need to use <code>Irrational</code>; in this case, <code>9π</code> is evaluated first and achieves full precision, and is then divided by the exact integer 5, so that it retains full precision.  Note that a helpful regex to search for this case is <code>(?&lt;!(ζ|n|\^))[0-9]+/[0-9]</code>, which has relatively few false positives in this repo.</li><li>A slight caveat to the above is that an expression like <code>3λ/2</code> could <em>still</em> be converted to <code>Float64</code> if <code>λ</code> is defined at compile time to be <code>0</code>.  For type-stability reasons, Julia will always treat <code>0/2</code> just like it would treat <code>7/2</code>, which is converted to <code>Float64</code>.  Thus, it is probably safest to write expressions like <code>3//2 * λ</code>.</li><li>If you happen to use any other math functions, similarly ensure that their arguments are converted appropriately to retain precision.  For unary functions, this can be done automatically by including the function name in the <code>unary_funcs</code> list used by <a href="../internals/utilities/#PostNewtonian.@pn_expression-Tuple{Any}"><code>@pn_expression</code></a>.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../internals/utilities/">« Utilities</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Monday 29 July 2024 19:36">Monday 29 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
