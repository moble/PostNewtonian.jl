<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Code structure · PostNewtonian.jl</title><meta name="title" content="Code structure · PostNewtonian.jl"/><meta property="og:title" content="Code structure · PostNewtonian.jl"/><meta property="twitter:title" content="Code structure · PostNewtonian.jl"/><meta name="description" content="Documentation for PostNewtonian.jl."/><meta property="og:description" content="Documentation for PostNewtonian.jl."/><meta property="twitter:description" content="Documentation for PostNewtonian.jl."/><meta property="og:url" content="https://moble.github.io/PostNewtonian.jl/stable/internals/code_structure/"/><meta property="twitter:url" content="https://moble.github.io/PostNewtonian.jl/stable/internals/code_structure/"/><link rel="canonical" href="https://moble.github.io/PostNewtonian.jl/stable/internals/code_structure/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PostNewtonian.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Interface</span><ul><li><a class="tocitem" href="../../interface/high-level/">High-level interface</a></li><li><a class="tocitem" href="../../interface/units/">Units</a></li><li><a class="tocitem" href="../../interface/differentiation/">Automatic differentiation</a></li><li><a class="tocitem" href="../../interface/assorted_binaries/">Assorted binaries</a></li><li><a class="tocitem" href="../../interface/python/">Python</a></li><li><a class="tocitem" href="../../interface/gwframes/">GWFrames</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li class="is-active"><a class="tocitem" href>Code structure</a></li><li><a class="tocitem" href="../pn_systems/">PN systems</a></li><li><a class="tocitem" href="../fundamental_variables/">Fundamental variables</a></li><li><a class="tocitem" href="../derived_variables/">Derived variables</a></li><li><a class="tocitem" href="../pn_expressions/">PN expressions</a></li><li><a class="tocitem" href="../dynamics/">Dynamics</a></li><li><a class="tocitem" href="../waveforms/">Waveforms</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li></ul></li><li><a class="tocitem" href="../../adding_terms/">Adding terms</a></li><li><a class="tocitem" href="../../apps_and_scripts/">Apps and scripts</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Code structure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Code structure</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/moble/PostNewtonian.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/moble/PostNewtonian.jl/blob/main/docs/src/internals/code_structure.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Structure-of-this-package&#39;s-code"><a class="docs-heading-anchor" href="#Structure-of-this-package&#39;s-code">Structure of this package&#39;s code</a><a id="Structure-of-this-package&#39;s-code-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-of-this-package&#39;s-code" title="Permalink"></a></h1><p>There is a fairly simple hierarchy to the code.  Beyond some basic utilities, which are related to how we write the code, rather than post-Newtonian calculations <em>per se</em>, we have the following:</p><ol><li><p><strong>System and state</strong></p><p>Objects of type <code>PNSystem</code> represent the PN system itself and some information about it, including:</p><ul><li>The <code>Binary</code> type — <code>BBH</code>, <code>BHNS</code>, or <code>NSNS</code></li><li>The float type <code>T</code> — <code>Float64</code>, etc.</li><li>The PN expansion order <code>PNOrder</code> — a <code>Rational</code></li><li>The current <code>state</code> of the system, including the fundamental variables</li></ul><p>The first of these is represented as the type itself, the last is stored as a vector inside the object, and the rest are represented as type parameters.</p><p>Note that basically everything below will be written as a function of such an object, which we will denote <code>pnsystem</code>.</p></li><li><p><strong>Fundamental variables</strong></p><p>This consists of the basic variables describing the instantaneous state of the system, including <code>M₁</code>, <code>M₂</code>, <code>χ⃗₁</code>, <code>χ⃗₂</code>, <code>R</code>, <code>v</code>. For systems with matter, this may also include tidal deformability for each star, <code>Λ₁</code> and <code>Λ₂</code>.</p><p>These are encapsulated within a <code>PNSystem</code>, but it&#39;s important to note that these should all be accessed through functions like <code>M₁(pnsystem)</code> rather than directly like <code>pnsystem.M₁</code>.  This allows Julia&#39;s type system to get involved, enabling important optimizations.</p><p>Also, these variables can be automatically computed in functions that need them with the <code>@pn_expression</code> macro.  For example, you can directly use the symbols <code>M₁</code>, <code>M₂</code>, etc., in a function that is wrapped in that macro, without any qualifiers to specify where those variables are coming from, and the macro will automatically and efficiently evaluate them for you because they are defined in the <code>PostNewtonian.FundamentalVariables</code> module.</p></li><li><p><strong>Derived variables</strong></p><p>These are variables that are frequently used in PN expressions that can be computed from the fundamental variables, and are <em>defined</em> in terms of them.  For example, the total mass <code>M ≔ M₁+M₂</code>, the antisymmetric spin vector <code>χ⃗ₐ ≔ (χ⃗₁-χ⃗₂)/2</code>, or the orbital separation vector <code>n̂ ≔ R x̂ R̄</code>.  While none of these are strictly necessary, it is helpful to be able to write the same variables used in articles providing the PN expressions in the code itself.</p><p>Because they are defined solely in terms of fundamental variables, which can be computed from an <code>PNSystem</code> alone, these are all written as functions of such an object — such as <code>M(pnsystem)</code>, <code>χ⃗ₐ(pnsystem)</code>, and <code>n̂(pnsystem)</code>.</p><p>Again, these quantities will be automatically computed for you in any function wrapped in the <code>@pn_expression</code> macro because they are defined in the <code>PostNewtonian.DerivedVariables</code> module.</p></li><li><p><strong>PN expressions</strong></p><p>Unlike derived variables, these are not necessarily defined in terms of only the fundamental variables, but they can be calculated in terms of both fundamental and derived variables.  These are generally the result of post-Newtonian expansions — the most important examples being the flux <a href="../pn_expressions/#PostNewtonian.𝓕-Union{Tuple{Any}, Tuple{PNExpansionReducer}} where PNExpansionReducer"><code>𝓕</code></a>, binding energy <a href="../pn_expressions/#PostNewtonian.𝓔-Union{Tuple{Any}, Tuple{PNExpansionReducer}} where PNExpansionReducer"><code>𝓔</code></a>, and the waveform mode weights <a href="../pn_expressions/#PostNewtonian.h!-Union{Tuple{PNExpansionReducer}, Tuple{Any, Any}} where PNExpansionReducer"><code>h!</code></a> themselves.</p></li><li><p><strong>PN expansions</strong></p><p>These are the specific parts of a &quot;PN expression&quot; that are expanded in powers of <span>$1/c$</span>.  For example, the flux <code>𝓕</code> and binding energy <code>𝓔</code> are expanded in powers of <span>$v/c$</span>.  When such PN expansions are defined using the <a href="../utilities/#PostNewtonian.@pn_expression-Tuple{Any}"><code>@pn_expression</code></a> macro, any occurrence of <code>c</code> is turned into an object that captures the exponent of <code>c</code> in that expression.  The expansion is automatically truncated at the appropriate order, and then <code>c</code> is finally set to <code>1</code> so that the result can be computed as usual.  See <a href="../utilities/#PostNewtonian.PNTerm"><code>PNTerm</code></a> and <a href="../utilities/#PostNewtonian.PNExpansion"><code>PNExpansion</code></a> for more details.</p></li><li><p><strong>Dynamics</strong></p><p>This is where the ODE integration actually occurs, to evolve the orbital dynamics of the system.</p></li><li><p><strong>Evaluation</strong></p><p>Finally, we construct the waveforms themselves.  This level contains the main interface that will usually be used from Julia code, and should be restricted to fairly high-level functions like <code>PNWaveform(M₁, M₂, ...)</code>, while still handling the full range of options that will be present in &quot;Dynamics&quot;, for example.</p></li><li><p><strong>Compatibility layers</strong></p><p>This is an optional level of abstraction that allows us to wrap the evaluation layer in functions that are designed to look and act more like other packages&#39; functions.  As of this writing, the only such layer is for <a href="https://github.com/moble/GWFrames"><code>GWFrames</code></a> compatibility, but similar wrappers could certainly be added.</p></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../interface/gwframes/">« GWFrames</a><a class="docs-footer-nextpage" href="../pn_systems/">PN systems »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 07:29">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
